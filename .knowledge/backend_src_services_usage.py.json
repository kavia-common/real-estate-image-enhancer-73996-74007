{"is_source_file": true, "format": "Python", "description": "This file defines the UsageService class responsible for tracking user usage statistics, such as images consumed, remaining trial credits, and totals for uploads and edits. It interacts with a database via SQLAlchemy, utilizing asynchronous queries and shared models for UsageLog.", "external_files": ["src/core/config", "src/models/models"], "external_methods": ["get_settings", "UsageLog"], "published": ["UsageService"], "classes": [{"name": "UsageService", "description": "A service class for recording and retrieving user usage data, including usage logging, computing remaining trial credits, and summarizing total images uploaded and edited."}], "methods": [{"name": "__init__(self, db: AsyncSession, user_id: int)", "description": "Initializes the UsageService with a database session and user ID.", "scope": "UsageService", "scopeKind": "class"}, {"name": "None add_usage(self, images_consumed: int, reason: str, notes: str | None = None)", "description": "Records a usage event for a user, including images consumed, reason, and optional notes.", "scope": "UsageService", "scopeKind": "class"}, {"name": "int trial_remaining(self)", "description": "Calculates how many images the user can still use in the trial period based on total consumed.", "scope": "UsageService", "scopeKind": "class"}, {"name": "tuple[int,int] totals(self)", "description": "Returns total images uploaded and edited by the user.", "scope": "UsageService", "scopeKind": "class"}, {"name": "int _total_consumed(self)", "description": "Private method that sums all images consumed by the user.", "scope": "UsageService", "scopeKind": "class"}, {"name": "int _sum_by_reason(self, reason: str)", "description": "Private method that sums images consumed for a specific reason (e.g., 'upload' or 'edit') for the user.", "scope": "UsageService", "scopeKind": "class"}], "calls": ["select", "func.coalesce", "UsageLog", "get_settings"], "search-terms": ["UsageLog", "UsageService", "add_usage", "trial_remaining", "totals", "AsyncSession", "usage tracking", "image credits"], "state": 2, "file_id": 11, "knowledge_revision": 24, "git_revision": "", "ctags": [{"_type": "tag", "name": "UsageService", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-74007/backend/src/services/usage.py", "pattern": "/^class UsageService:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-74007/backend/src/services/usage.py", "pattern": "/^    def __init__(self, db: AsyncSession, user_id: int):$/", "language": "Python", "kind": "member", "signature": "(self, db: AsyncSession, user_id: int)", "scope": "UsageService", "scopeKind": "class"}, {"_type": "tag", "name": "_sum_by_reason", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-74007/backend/src/services/usage.py", "pattern": "/^    async def _sum_by_reason(self, reason: str) -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "member", "signature": "(self, reason: str)", "scope": "UsageService", "scopeKind": "class"}, {"_type": "tag", "name": "_total_consumed", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-74007/backend/src/services/usage.py", "pattern": "/^    async def _total_consumed(self) -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "member", "signature": "(self)", "scope": "UsageService", "scopeKind": "class"}, {"_type": "tag", "name": "add_usage", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-74007/backend/src/services/usage.py", "pattern": "/^    async def add_usage(self, images_consumed: int, reason: str, notes: str | None = None) -> No/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, images_consumed: int, reason: str, notes: str | None = None)", "scope": "UsageService", "scopeKind": "class"}, {"_type": "tag", "name": "settings", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-74007/backend/src/services/usage.py", "pattern": "/^settings = get_settings()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "totals", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-74007/backend/src/services/usage.py", "pattern": "/^    async def totals(self) -> tuple[int, int]:$/", "language": "Python", "typeref": "typename:tuple[int,int]", "kind": "member", "signature": "(self)", "scope": "UsageService", "scopeKind": "class"}, {"_type": "tag", "name": "trial_remaining", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-74007/backend/src/services/usage.py", "pattern": "/^    async def trial_remaining(self) -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "member", "signature": "(self)", "scope": "UsageService", "scopeKind": "class"}], "hash": "dca5f8377368f71fd6ac80083f792d64", "format-version": 4, "code-base-name": "backend", "filename": "backend/src/services/usage.py", "fields": [{"name": "settings = get_settings()", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"24": ""}]}